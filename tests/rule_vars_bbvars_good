#!/bin/sh
TESTFILE="${TMP}oelint_adv_test.bb"
trap "rm -f ${TESTFILE}" EXIT
TESTID="oelint.vars.bbvars.*"
TESTOCC="0"
cat > ${TESTFILE} << EOF
BB_CONSOLELOG ?= "foo"
BB_CURRENTTASK ?= "foo"
BB_DANGLINGAPPENDS_WARNONLY ?= "foo"
BB_DEFAULT_TASK ?= "foo"
BB_DISKMON_DIRS ?= "foo"
BB_DISKMON_WARNINTERVAL ?= "foo"
BB_ENV_EXTRAWHITE ?= "foo"
BB_ENV_WHITELIST ?= "foo"
BB_FETCH_PREMIRRORONLY ?= "foo"
BB_FILENAME ?= "foo"
BB_GENERATE_MIRROR_TARBALLS ?= "foo"
BB_HASHBASE_WHITELIST ?= "foo"
BB_HASHCHECK_FUNCTION ?= "foo"
BB_HASHCONFIG_WHITELIST ?= "foo"
BB_INVALIDCONF ?= "foo"
BB_LOGFMT ?= "foo"
BB_NICE_LEVEL ?= "foo"
BB_NO_NETWORK ?= "foo"
BB_NUMBER_PARSE_THREADS ?= "foo"
BB_NUMBER_THREADS ?= "foo"
BB_ORIGENV ?= "foo"
BB_PRESERVE_ENV ?= "foo"
BB_RUNFMT ?= "foo"
BB_RUNTASK ?= "foo"
BB_SCHEDULER ?= "foo"
BB_SCHEDULERS ?= "foo"
BB_SETSCENE_DEPVALID ?= "foo"
BB_SETSCENE_VERIFY_FUNCTION ?= "foo"
BB_SIGNATURE_EXCLUDE_FLAGS ?= "foo"
BB_SIGNATURE_HANDLER ?= "foo"
BB_SRCREV_POLICY ?= "foo"
BB_STAMP_POLICY ?= "foo"
BB_STAMP_WHITELIST ?= "foo"
BB_STRICT_CHECKSUM ?= "foo"
BB_TASK_NICE_LEVEL ?= "foo"
BB_TASKHASH ?= "foo"
BB_VERBOSE_LOGS ?= "foo"
BB_WORKERCONTEXT ?= "foo"
BBDEBUG ?= "foo"
BBFILE_COLLECTIONS ?= "foo"
BBFILE_PATTERN ?= "foo"
BBFILE_PRIORITY ?= "foo"
BBFILES ?= "foo"
BBINCLUDED ?= "foo"
BBINCLUDELOGS ?= "foo"
BBINCLUDELOGS_LINES ?= "foo"
BBLAYERS ?= "foo"
BBMASK ?= "foo"
BBPATH ?= "foo"
BBSERVER ?= "foo"
BBVERSIONS ?= "foo"
BITBAKE_UI ?= "foo"
BUILDNAME ?= "foo"
CACHE ?= "foo"
DEFAULT_PREFERENCE ?= "foo"
DL_DIR ?= "foo"
FILE ?= "foo"
FILESDIR ?= "foo"
FILESPATH ?= "foo"
INHERIT ?= "foo"
LAYERDEPENDS ?= "foo"
LAYERDIR ?= "foo"
LAYERVERSION ?= "foo"
MIRRORS ?= "foo"
MULTI_PROVIDER_WHITELIST ?= "foo"
PERSISTENT_DIR ?= "foo"
PREFERRED_PROVIDER ?= "foo"
PREFERRED_PROVIDERS ?= "foo"
PREFERRED_VERSION ?= "foo"
PREMIRRORS ?= "foo"
PRSERV_HOST ?= "foo"
STAMP ?= "foo"
TOPDIR ?= "foo"
BB_CONSOLELOG ??= "foo"
BB_CURRENTTASK ??= "foo"
BB_DANGLINGAPPENDS_WARNONLY ??= "foo"
BB_DEFAULT_TASK ??= "foo"
BB_DISKMON_DIRS ??= "foo"
BB_DISKMON_WARNINTERVAL ??= "foo"
BB_ENV_EXTRAWHITE ??= "foo"
BB_ENV_WHITELIST ??= "foo"
BB_FETCH_PREMIRRORONLY ??= "foo"
BB_FILENAME ??= "foo"
BB_GENERATE_MIRROR_TARBALLS ??= "foo"
BB_HASHBASE_WHITELIST ??= "foo"
BB_HASHCHECK_FUNCTION ??= "foo"
BB_HASHCONFIG_WHITELIST ??= "foo"
BB_INVALIDCONF ??= "foo"
BB_LOGFMT ??= "foo"
BB_NICE_LEVEL ??= "foo"
BB_NO_NETWORK ??= "foo"
BB_NUMBER_PARSE_THREADS ??= "foo"
BB_NUMBER_THREADS ??= "foo"
BB_ORIGENV ??= "foo"
BB_PRESERVE_ENV ??= "foo"
BB_RUNFMT ??= "foo"
BB_RUNTASK ??= "foo"
BB_SCHEDULER ??= "foo"
BB_SCHEDULERS ??= "foo"
BB_SETSCENE_DEPVALID ??= "foo"
BB_SETSCENE_VERIFY_FUNCTION ??= "foo"
BB_SIGNATURE_EXCLUDE_FLAGS ??= "foo"
BB_SIGNATURE_HANDLER ??= "foo"
BB_SRCREV_POLICY ??= "foo"
BB_STAMP_POLICY ??= "foo"
BB_STAMP_WHITELIST ??= "foo"
BB_STRICT_CHECKSUM ??= "foo"
BB_TASK_NICE_LEVEL ??= "foo"
BB_TASKHASH ??= "foo"
BB_VERBOSE_LOGS ??= "foo"
BB_WORKERCONTEXT ??= "foo"
BBDEBUG ??= "foo"
BBFILE_COLLECTIONS ??= "foo"
BBFILE_PATTERN ??= "foo"
BBFILE_PRIORITY ??= "foo"
BBFILES ??= "foo"
BBINCLUDED ??= "foo"
BBINCLUDELOGS ??= "foo"
BBINCLUDELOGS_LINES ??= "foo"
BBLAYERS ??= "foo"
BBMASK ??= "foo"
BBPATH ??= "foo"
BBSERVER ??= "foo"
BBVERSIONS ??= "foo"
BITBAKE_UI ??= "foo"
BUILDNAME ??= "foo"
CACHE ??= "foo"
DEFAULT_PREFERENCE ??= "foo"
DL_DIR ??= "foo"
FILE ??= "foo"
FILESDIR ??= "foo"
FILESPATH ??= "foo"
INHERIT ??= "foo"
LAYERDEPENDS ??= "foo"
LAYERDIR ??= "foo"
LAYERVERSION ??= "foo"
MIRRORS ??= "foo"
MULTI_PROVIDER_WHITELIST ??= "foo"
PERSISTENT_DIR ??= "foo"
PREFERRED_PROVIDER ??= "foo"
PREFERRED_PROVIDERS ??= "foo"
PREFERRED_VERSION ??= "foo"
PREMIRRORS ??= "foo"
PRSERV_HOST ??= "foo"
STAMP ??= "foo"
TOPDIR ??= "foo"
EOF
[ $(python3 -m oelint_adv ${TESTFILE} 2>&1 | grep ":${TESTID}:" | wc -l) = "${TESTOCC}" ] && exit 0;
python3 -m oelint_adv --addrules=jetm ${TESTFILE} 2>&1
_got=$(python3 -m oelint_adv --addrules=jetm ${TESTFILE} 2>&1 | grep ":${TESTID}:" | wc -l)
echo "Test for ${0} failed - got ${_got} expected ${TESTOCC}"
exit 1