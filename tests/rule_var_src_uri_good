#!/bin/sh
TESTFILE="${TMP}oelint_adv_test.bb"
trap "rm -f ${TESTFILE}" EXIT
TESTID="oelint.vars.srcurioptions"
TESTOCC="0"
cat > ${TESTFILE} << EOF
SRC_URI += "file://foo"
SRC_URI += "file://foo;apply=true"
SRC_URI += "file://foo;apply=false"
SRC_URI += "file://foo;destsuffix=Bla"
SRC_URI += "file://foo;name=foo"
SRC_URI += "file://foo;patchdir=sjdjds"
SRC_URI += "file://foo;striplevel=10"
SRC_URI += "file://foo;subdir=sjdad"
SRC_URI += "file://foo;unpack=true"
SRC_URI += "file://foo;unpack=false"
SRC_URI += "file://foo;downloadfilename=foo"
SRC_URI += "file://foo.some.ext;downloadfilename=foo"
SRC_URI += "bzr://foo"
SRC_URI += "bzr://foo;protocol=bzr"
SRC_URI += "bzr://foo;scmdata=foo"
SRC_URI += "bzr://foo;apply=true"
SRC_URI += "bzr://foo;apply=false"
SRC_URI += "bzr://foo;destsuffix=Bla"
SRC_URI += "bzr://foo;name=foo"
SRC_URI += "bzr://foo;patchdir=sjdjds"
SRC_URI += "bzr://foo;striplevel=10"
SRC_URI += "bzr://foo;subdir=sjdad"
SRC_URI += "bzr://foo;unpack=true"
SRC_URI += "bzr://foo;unpack=false"
SRC_URI += "crcc://foo"
SRC_URI += "crcc://foo;module=foo"
SRC_URI += "crcc://foo;proto=crcc"
SRC_URI += "crcc://foo;vob=foo"
SRC_URI += "crcc://foo;apply=true"
SRC_URI += "crcc://foo;apply=false"
SRC_URI += "crcc://foo;destsuffix=Bla"
SRC_URI += "crcc://foo;name=foo"
SRC_URI += "crcc://foo;patchdir=sjdjds"
SRC_URI += "crcc://foo;striplevel=10"
SRC_URI += "crcc://foo;subdir=sjdad"
SRC_URI += "crcc://foo;unpack=true"
SRC_URI += "crcc://foo;unpack=false"
SRC_URI += "cvs://foo"
SRC_URI += "cvs://foo;date=123456"
SRC_URI += "cvs://foo;fullpath=foo"
SRC_URI += "cvs://foo;localdir=foo"
SRC_URI += "cvs://foo;method=foo"
SRC_URI += "cvs://foo;module=foo"
SRC_URI += "cvs://foo;norecurse=true"
SRC_URI += "cvs://foo;norecurse=false"
SRC_URI += "cvs://foo;port=123"
SRC_URI += "cvs://foo;rsh=foo"
SRC_URI += "cvs://foo;scmdata=foo"
SRC_URI += "cvs://foo;tag=foo"
SRC_URI += "cvs://foo;apply=true"
SRC_URI += "cvs://foo;apply=false"
SRC_URI += "cvs://foo;destsuffix=Bla"
SRC_URI += "cvs://foo;name=foo"
SRC_URI += "cvs://foo;patchdir=sjdjds"
SRC_URI += "cvs://foo;striplevel=10"
SRC_URI += "cvs://foo;subdir=sjdad"
SRC_URI += "cvs://foo;unpack=true"
SRC_URI += "cvs://foo;unpack=false"
SRC_URI += "ftp://foo"
SRC_URI += "ftp://foo;downloadfilename=foo"
SRC_URI += "ftp://foo;apply=true"
SRC_URI += "ftp://foo;apply=false"
SRC_URI += "ftp://foo;destsuffix=Bla"
SRC_URI += "ftp://foo;name=foo"
SRC_URI += "ftp://foo;patchdir=sjdjds"
SRC_URI += "ftp://foo;striplevel=10"
SRC_URI += "ftp://foo;subdir=sjdad"
SRC_URI += "ftp://foo;unpack=true"
SRC_URI += "ftp://foo;unpack=false"
SRC_URI += "git://foo"
SRC_URI += "git://foo;branch=foo"
SRC_URI += "git://foo;destsuffix=foo"
SRC_URI += "git://foo;nobranch=true"
SRC_URI += "git://foo;nobranch=false"
SRC_URI += "git://foo;nocheckout=true"
SRC_URI += "git://foo;nocheckout=false"
SRC_URI += "git://foo;protocol=git"
SRC_URI += "git://foo;rebaseable=true"
SRC_URI += "git://foo;rebaseable=false"
SRC_URI += "git://foo;rev=abcdefgh"
SRC_URI += "git://foo;subpath=foo"
SRC_URI += "git://foo;tag=foo"
SRC_URI += "git://foo;usehead=true"
SRC_URI += "git://foo;usehead=false"
SRC_URI += "git://foo;apply=true"
SRC_URI += "git://foo;apply=false"
SRC_URI += "git://foo;destsuffix=Bla"
SRC_URI += "git://foo;name=foo"
SRC_URI += "git://foo;patchdir=sjdjds"
SRC_URI += "git://foo;striplevel=10"
SRC_URI += "git://foo;subdir=sjdad"
SRC_URI += "git://foo;unpack=true"
SRC_URI += "git://foo;unpack=false"
SRC_URI += "gitsm://foo"
SRC_URI += "gitsm://foo;branch=foo"
SRC_URI += "gitsm://foo;destsuffix=foo"
SRC_URI += "gitsm://foo;nobranch=true"
SRC_URI += "gitsm://foo;nobranch=false"
SRC_URI += "gitsm://foo;nocheckout=true"
SRC_URI += "gitsm://foo;nocheckout=false"
SRC_URI += "gitsm://foo;protocol=git"
SRC_URI += "gitsm://foo;rebaseable=true"
SRC_URI += "gitsm://foo;rebaseable=false"
SRC_URI += "gitsm://foo;rev=abcdefgh"
SRC_URI += "gitsm://foo;subpath=foo"
SRC_URI += "gitsm://foo;tag=foo"
SRC_URI += "gitsm://foo;usehead=true"
SRC_URI += "gitsm://foo;usehead=false"
SRC_URI += "gitsm://foo;apply=true"
SRC_URI += "gitsm://foo;apply=false"
SRC_URI += "gitsm://foo;destsuffix=Bla"
SRC_URI += "gitsm://foo;name=foo"
SRC_URI += "gitsm://foo;patchdir=sjdjds"
SRC_URI += "gitsm://foo;striplevel=10"
SRC_URI += "gitsm://foo;subdir=sjdad"
SRC_URI += "gitsm://foo;unpack=true"
SRC_URI += "gitsm://foo;unpack=false"
SRC_URI += "gitannex://foo"
SRC_URI += "hg://foo"
SRC_URI += "hg://foo;module=foo"
SRC_URI += "hg://foo;rev=foo"
SRC_URI += "hg://foo;scmdata=foo"
SRC_URI += "hg://foo;apply=true"
SRC_URI += "hg://foo;apply=false"
SRC_URI += "hg://foo;destsuffix=Bla"
SRC_URI += "hg://foo;name=foo"
SRC_URI += "hg://foo;patchdir=sjdjds"
SRC_URI += "hg://foo;striplevel=10"
SRC_URI += "hg://foo;subdir=sjdad"
SRC_URI += "hg://foo;unpack=true"
SRC_URI += "hg://foo;unpack=false"
SRC_URI += "hg://foo;protocol=http"
SRC_URI += "http://foo"
SRC_URI += "http://foo;apply=true"
SRC_URI += "http://foo;apply=false"
SRC_URI += "http://foo;destsuffix=Bla"
SRC_URI += "http://foo;name=foo"
SRC_URI += "http://foo;patchdir=sjdjds"
SRC_URI += "http://foo;striplevel=10"
SRC_URI += "http://foo;subdir=sjdad"
SRC_URI += "http://foo;unpack=true"
SRC_URI += "http://foo;unpack=false"
SRC_URI += "http://foo;downloadfilename=foo"
SRC_URI += "https://foo"
SRC_URI += "https://foo;apply=true"
SRC_URI += "https://foo;apply=false"
SRC_URI += "https://foo;destsuffix=Bla"
SRC_URI += "https://foo;name=foo"
SRC_URI += "https://foo;patchdir=sjdjds"
SRC_URI += "https://foo;striplevel=10"
SRC_URI += "https://foo;subdir=sjdad"
SRC_URI += "https://foo;unpack=true"
SRC_URI += "https://foo;unpack=false"
SRC_URI += "https://foo;downloadfilename=foo"
SRC_URI += "osc://foo"
SRC_URI += "osc://foo;module=foo"
SRC_URI += "osc://foo;protocol=foo"
SRC_URI += "osc://foo;rev=foo"
SRC_URI += "osc://foo;apply=true"
SRC_URI += "osc://foo;apply=false"
SRC_URI += "osc://foo;destsuffix=Bla"
SRC_URI += "osc://foo;name=foo"
SRC_URI += "osc://foo;patchdir=sjdjds"
SRC_URI += "osc://foo;striplevel=10"
SRC_URI += "osc://foo;subdir=sjdad"
SRC_URI += "osc://foo;unpack=true"
SRC_URI += "osc://foo;unpack=false"
SRC_URI += "p4://foo"
SRC_URI += "p4://foo;revision=foo"
SRC_URI += "p4://foo;apply=true"
SRC_URI += "p4://foo;apply=false"
SRC_URI += "p4://foo;destsuffix=Bla"
SRC_URI += "p4://foo;name=foo"
SRC_URI += "p4://foo;patchdir=sjdjds"
SRC_URI += "p4://foo;striplevel=10"
SRC_URI += "p4://foo;subdir=sjdad"
SRC_URI += "p4://foo;unpack=true"
SRC_URI += "p4://foo;unpack=false"
SRC_URI += "repo://foo"
SRC_URI += "repo://foo;branch=foo"
SRC_URI += "repo://foo;manifest=foo"
SRC_URI += "repo://foo;protocol=foo"
SRC_URI += "repo://foo;apply=true"
SRC_URI += "repo://foo;apply=false"
SRC_URI += "repo://foo;destsuffix=Bla"
SRC_URI += "repo://foo;name=foo"
SRC_URI += "repo://foo;patchdir=sjdjds"
SRC_URI += "repo://foo;striplevel=10"
SRC_URI += "repo://foo;subdir=sjdad"
SRC_URI += "repo://foo;unpack=true"
SRC_URI += "repo://foo;unpack=false"
SRC_URI += "ssh://foo"
SRC_URI += "ssh://foo;apply=true"
SRC_URI += "ssh://foo;apply=false"
SRC_URI += "ssh://foo;destsuffix=Bla"
SRC_URI += "ssh://foo;name=foo"
SRC_URI += "ssh://foo;patchdir=sjdjds"
SRC_URI += "ssh://foo;striplevel=10"
SRC_URI += "ssh://foo;subdir=sjdad"
SRC_URI += "ssh://foo;unpack=true"
SRC_URI += "ssh://foo;unpack=false"
SRC_URI += "s3://foo;apply=true"
SRC_URI += "s3://foo;apply=false"
SRC_URI += "s3://foo;destsuffix=Bla"
SRC_URI += "s3://foo;name=foo"
SRC_URI += "s3://foo;patchdir=sjdjds"
SRC_URI += "s3://foo;striplevel=10"
SRC_URI += "s3://foo;subdir=sjdad"
SRC_URI += "s3://foo;unpack=true"
SRC_URI += "s3://foo;unpack=false"
SRC_URI += "s3://foo;downloadfilename=foo"
SRC_URI += "sftp://foo"
SRC_URI += "sftp://foo;protocol=true"
SRC_URI += "sftp://foo;apply=true"
SRC_URI += "sftp://foo;apply=true"
SRC_URI += "sftp://foo;apply=false"
SRC_URI += "sftp://foo;destsuffix=Bla"
SRC_URI += "sftp://foo;name=foo"
SRC_URI += "sftp://foo;patchdir=sjdjds"
SRC_URI += "sftp://foo;striplevel=10"
SRC_URI += "sftp://foo;subdir=sjdad"
SRC_URI += "sftp://foo;unpack=true"
SRC_URI += "sftp://foo;unpack=false"
SRC_URI += "sftp://foo;downloadfilename=foo"
SRC_URI += "npm://foo"
SRC_URI += "npm://foo;name=foo"
SRC_URI += "npm://foo;noverify=true"
SRC_URI += "npm://foo;noverify=false"
SRC_URI += "npm://foo;version=foo"
SRC_URI += "npm://foo;apply=true"
SRC_URI += "npm://foo;apply=true"
SRC_URI += "npm://foo;apply=false"
SRC_URI += "npm://foo;destsuffix=Bla"
SRC_URI += "npm://foo;name=foo"
SRC_URI += "npm://foo;patchdir=sjdjds"
SRC_URI += "npm://foo;striplevel=10"
SRC_URI += "npm://foo;subdir=sjdad"
SRC_URI += "npm://foo;unpack=true"
SRC_URI += "npm://foo;unpack=false"
SRC_URI += "svn://foo"
SRC_URI += "svn://foo;module=foo"
SRC_URI += "svn://foo;path_spec=foo"
SRC_URI += "svn://foo;protocol=foo"
SRC_URI += "svn://foo;rev=foo"
SRC_URI += "svn://foo;scmdata=foo"
SRC_URI += "svn://foo;ssh=foo"
SRC_URI += "svn://foo;transportuser=foo"
SRC_URI += "svn://foo;apply=true"
SRC_URI += "svn://foo;apply=false"
SRC_URI += "svn://foo;destsuffix=Bla"
SRC_URI += "svn://foo;name=foo"
SRC_URI += "svn://foo;patchdir=sjdjds"
SRC_URI += "svn://foo;striplevel=10"
SRC_URI += "svn://foo;subdir=sjdad"
SRC_URI += "svn://foo;unpack=true"
SRC_URI += "svn://foo;unpack=false"
SRC_URI += " svn://foo;unpack=false "
SRC_URI += "\${@["", "file://init.cfg"][(d.getVar('VIRTUAL-RUNTIME_init_manager') == 'busybox')]}"
SRC_URI += "npmsw://foo"
SRC_URI += "npmsw://foo;dev=1"
SRC_URI += "npmsw://foo;dev=0"
SRC_URI += "npmsw://foo;destsuffix=abc"
SRC_URI += "npmsw://foo;destsuffix=abc;dev=1"
EOF
[ $(python3 -m oelint_adv ${TESTFILE} 2>&1 | grep ":${TESTID}:" | wc -l) = "${TESTOCC}" ] && exit 0;
python3 -m oelint_adv --addrules=jetm ${TESTFILE} 2>&1
_got=$(python3 -m oelint_adv --addrules=jetm ${TESTFILE} 2>&1 | grep ":${TESTID}:" | wc -l)
echo "Test for ${0} failed - got ${_got} expected ${TESTOCC}"
exit 1